(()=>{"use strict";var e={800:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=t.loadMessageBundle=t.localize=t.format=t.setPseudo=t.isPseudo=t.isString=t.isNumber=t.isDefined=t.BundleFormat=t.MessageFormat=void 0;var r,n,s,a=o(926);function i(e){return void 0!==e}(s=t.MessageFormat||(t.MessageFormat={})).file="file",s.bundle="bundle",s.both="both",(n=t.BundleFormat||(t.BundleFormat={})).standalone="standalone",n.languagePack="languagePack",function(e){e.is=function(e){var t=e;return t&&i(t.key)&&i(t.comment)}}(r||(r={})),t.isDefined=i;var c=Object.prototype.toString;function l(e,o){return t.isPseudo&&(e="［"+e.replace(/[aouei]/g,"$&$&")+"］"),0===o.length?e:e.replace(/\{(\d+)\}/g,(function(e,t){var r=t[0],n=o[r],s=e;return"string"==typeof n?s=n:"number"!=typeof n&&"boolean"!=typeof n&&null!=n||(s=String(n)),s}))}t.isNumber=function(e){return"[object Number]"===c.call(e)},t.isString=function(e){return"[object String]"===c.call(e)},t.isPseudo=!1,t.setPseudo=function(e){t.isPseudo=e},t.format=l,t.localize=function(e,t){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];return l(t,o)},t.loadMessageBundle=function(e){return(0,a.default)().loadMessageBundle(e)},t.config=function(e){return(0,a.default)().config(e)}},926:(e,t)=>{var o;function r(){if(void 0===o)throw new Error("No runtime abstraction layer installed");return o}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.install=function(e){if(void 0===e)throw new Error("No runtime abstraction layer provided");o=e}}(r||(r={})),t.default=r},472:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.config=t.loadMessageBundle=t.BundleFormat=t.MessageFormat=void 0;var r,n,s=o(622),a=o(747),i=o(926),c=o(800),l=o(800);function u(e){return JSON.parse(a.readFileSync(e,"utf8"))}function d(e){return function(t,o){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return(0,c.isNumber)(t)?t>=e.length?void console.error("Broken localize call found. Index out of bounds. Stacktrace is\n: ".concat(new Error("").stack)):(0,c.format)(e[t],r):(0,c.isString)(o)?(console.warn("Message ".concat(o," didn't get externalized correctly.")),(0,c.format)(o,r)):void console.error("Broken localize call found. Stacktrace is\n: ".concat(new Error("").stack))}}function f(e,t){return r[e]=t,t}function g(e){try{return function(e){var t=u(s.join(e,"nls.metadata.json")),o=Object.create(null);for(var r in t){var n=t[r];o[r]=n.messages}return o}(e)}catch(e){return void console.log("Generating default bundle from meta data failed.",e)}}function p(e,t){var o;if(!0===n.languagePackSupport&&void 0!==n.cacheRoot&&void 0!==n.languagePackId&&void 0!==n.translationsConfigFile&&void 0!==n.translationsConfig)try{o=function(e,t){var o,r,i,l=s.join(n.cacheRoot,"".concat(e.id,"-").concat(e.hash,".json")),d=!1,f=!1;try{return o=JSON.parse(a.readFileSync(l,{encoding:"utf8",flag:"r"})),r=l,i=new Date,a.utimes(r,i,i,(function(){})),o}catch(e){if("ENOENT"===e.code)f=!0;else{if(!(e instanceof SyntaxError))throw e;console.log("Syntax error parsing message bundle: ".concat(e.message,".")),a.unlink(l,(function(e){e&&console.error("Deleting corrupted bundle ".concat(l," failed."))})),d=!0}}if(!(o=function(e,t){var o=n.translationsConfig[e.id];if(o){var r=u(o).contents,a=u(s.join(t,"nls.metadata.json")),i=Object.create(null);for(var l in a){var d=a[l],f=r["".concat(e.outDir,"/").concat(l)];if(f){for(var g=[],p=0;p<d.keys.length;p++){var h=d.keys[p],v=f[(0,c.isString)(h)?h:h.key];void 0===v&&(v=d.messages[p]),g.push(v)}i[l]=g}else i[l]=d.messages}return i}}(e,t))||d)return o;if(f)try{a.writeFileSync(l,JSON.stringify(o),{encoding:"utf8",flag:"wx"})}catch(e){if("EEXIST"===e.code)return o;throw e}return o}(e,t)}catch(e){console.log("Load or create bundle failed ",e)}if(!o){if(n.languagePackSupport)return g(t);var r=function(e){for(var t=n.language;t;){var o=s.join(e,"nls.bundle.".concat(t,".json"));if(a.existsSync(o))return o;var r=t.lastIndexOf("-");t=r>0?t.substring(0,r):void 0}if(void 0===t&&(o=s.join(e,"nls.bundle.json"),a.existsSync(o)))return o}(t);if(r)try{return u(r)}catch(e){console.log("Loading in the box message bundle failed.",e)}o=g(t)}return o}function h(e){if(!e)return c.localize;var t=s.extname(e);if(t&&(e=e.substr(0,e.length-t.length)),n.messageFormat===c.MessageFormat.both||n.messageFormat===c.MessageFormat.bundle){var o=function(e){for(var t,o=s.dirname(e);t=s.join(o,"nls.metadata.header.json"),!a.existsSync(t);){var r=s.dirname(o);if(r===o){t=void 0;break}o=r}return t}(e);if(o){var i=s.dirname(o),l=r[i];if(void 0===l)try{var g=JSON.parse(a.readFileSync(o,"utf8"));try{var h=p(g,i);l=f(i,h?{header:g,nlsBundle:h}:null)}catch(e){console.error("Failed to load nls bundle",e),l=f(i,null)}}catch(e){console.error("Failed to read header file",e),l=f(i,null)}if(l){var v=e.substr(i.length+1).replace(/\\/g,"/"),m=l.nlsBundle[v];return void 0===m?(console.error("Messages for file ".concat(e," not found. See console for details.")),function(){return"Messages not found."}):d(m)}}}if(n.messageFormat===c.MessageFormat.both||n.messageFormat===c.MessageFormat.file)try{var k=u(function(e){var t;if(n.cacheLanguageResolution&&t)t=t;else{if(c.isPseudo||!n.language)t=".nls.json";else for(var o=n.language;o;){var r=".nls."+o+".json";if(a.existsSync(e+r)){t=r;break}var s=o.lastIndexOf("-");s>0?o=o.substring(0,s):(t=".nls.json",o=null)}n.cacheLanguageResolution&&(t=t)}return e+t}(e));return Array.isArray(k)?d(k):(0,c.isDefined)(k.messages)&&(0,c.isDefined)(k.keys)?d(k.messages):(console.error("String bundle '".concat(e,"' uses an unsupported format.")),function(){return"File bundle has unsupported format. See console for details"})}catch(e){"ENOENT"!==e.code&&console.error("Failed to load single file bundle",e)}return console.error("Failed to load message bundle for file ".concat(e)),function(){return"Failed to load message bundle. See console for details."}}function v(e){return e&&((0,c.isString)(e.locale)&&(n.locale=e.locale.toLowerCase(),n.language=n.locale,r=Object.create(null)),void 0!==e.messageFormat&&(n.messageFormat=e.messageFormat),e.bundleFormat===c.BundleFormat.standalone&&!0===n.languagePackSupport&&(n.languagePackSupport=!1)),(0,c.setPseudo)("pseudo"===n.locale),h}Object.defineProperty(t,"MessageFormat",{enumerable:!0,get:function(){return l.MessageFormat}}),Object.defineProperty(t,"BundleFormat",{enumerable:!0,get:function(){return l.BundleFormat}}),function(){if(n={locale:void 0,language:void 0,languagePackSupport:!1,cacheLanguageResolution:!0,messageFormat:c.MessageFormat.bundle},(0,c.isString)(process.env.VSCODE_NLS_CONFIG))try{var e=JSON.parse(process.env.VSCODE_NLS_CONFIG),t=void 0;if(e.availableLanguages){var o=e.availableLanguages["*"];(0,c.isString)(o)&&(t=o)}if((0,c.isString)(e.locale)&&(n.locale=e.locale.toLowerCase()),void 0===t?n.language=n.locale:"en"!==t&&(n.language=t),function(e){return!0===e||!1===e}(e._languagePackSupport)&&(n.languagePackSupport=e._languagePackSupport),(0,c.isString)(e._cacheRoot)&&(n.cacheRoot=e._cacheRoot),(0,c.isString)(e._languagePackId)&&(n.languagePackId=e._languagePackId),(0,c.isString)(e._translationsConfigFile)){n.translationsConfigFile=e._translationsConfigFile;try{n.translationsConfig=u(n.translationsConfigFile)}catch(t){if(e._corruptedFile){var i=s.dirname(e._corruptedFile);a.exists(i,(function(t){t&&a.writeFile(e._corruptedFile,"corrupted","utf8",(function(e){console.error(e)}))}))}}}}catch(e){}(0,c.setPseudo)("pseudo"===n.locale),r=Object.create(null)}(),t.loadMessageBundle=h,t.config=v,i.default.install(Object.freeze({loadMessageBundle:h,config:v}))},129:e=>{e.exports=require("child_process")},747:e=>{e.exports=require("fs")},622:e=>{e.exports=require("path")},549:e=>{e.exports=require("vscode")}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=o(622),n=o(747),s=o(129),a=o(549),i=o(472).loadMessageBundle(o(622).join(__dirname,"main.ts"));function c(e){return new Promise(((t,o)=>{n.exists(e,(e=>{t(e)}))}))}const l=["build","compile","watch"];function u(e){for(const t of l)if(-1!==e.indexOf(t))return!0;return!1}const d=["test"];function f(e){for(const t of d)if(-1!==e.indexOf(t))return!0;return!1}let g,p;function h(){return g||(g=a.window.createOutputChannel("Jake Auto Detection")),g}function v(){a.window.showWarningMessage(i(0,null),i(1,null)).then((()=>{h().show(!0)}))}async function m(e){let o;const r=process.platform;return o="win32"===r&&await c(t.join(e,"node_modules",".bin","jake.cmd"))?t.join(".","node_modules",".bin","jake.cmd"):"linux"!==r&&"darwin"!==r||!await c(t.join(e,"node_modules",".bin","jake"))?"jake":t.join(".","node_modules",".bin","jake"),o}class k{constructor(e,t){this._workspaceFolder=e,this._jakeCommand=t}get workspaceFolder(){return this._workspaceFolder}isEnabled(){return"on"===a.workspace.getConfiguration("jake",this._workspaceFolder.uri).get("autoDetect")}start(){const e=t.join(this._workspaceFolder.uri.fsPath,"{node_modules,Jakefile,Jakefile.js}");this.fileWatcher=a.workspace.createFileSystemWatcher(e),this.fileWatcher.onDidChange((()=>this.promise=void 0)),this.fileWatcher.onDidCreate((()=>this.promise=void 0)),this.fileWatcher.onDidDelete((()=>this.promise=void 0))}async getTasks(){return this.isEnabled()?(this.promise||(this.promise=this.computeTasks()),this.promise):[]}async getTask(e){const t=e.definition.task;if(t){const o=e.definition,r={cwd:this.workspaceFolder.uri.fsPath};return new a.Task(o,this.workspaceFolder,t,"jake",new a.ShellExecution(await this._jakeCommand,[t],r))}}async computeTasks(){const e="file"===this._workspaceFolder.uri.scheme?this._workspaceFolder.uri.fsPath:void 0,o=[];if(!e)return o;let r=t.join(e,"Jakefile");if(!await c(r)&&(r=t.join(e,"Jakefile.js"),!await c(r)))return o;const n=`${await this._jakeCommand} --tasks`;try{const{stdout:t,stderr:o}=await(l=n,d={cwd:e},new Promise(((e,t)=>{s.exec(l,d,((o,r,n)=>{o&&t({error:o,stdout:r,stderr:n}),e({stdout:r,stderr:n})}))})));o&&(h().appendLine(o),v());const r=[];if(t){const e=t.split(/\r{0,1}\n/);for(const t of e){if(0===t.length)continue;const e=/^jake\s+([^\s]+)\s/g.exec(t);if(e&&2===e.length){const o=e[1],n={type:"jake",task:o},s={cwd:this.workspaceFolder.uri.fsPath},i=new a.Task(n,o,"jake",new a.ShellExecution(`${await this._jakeCommand} ${o}`,s));r.push(i);const c=t.toLowerCase();u(c)?i.group=a.TaskGroup.Build:f(c)&&(i.group=a.TaskGroup.Test)}}}return r}catch(e){const t=h();return e.stderr&&t.appendLine(e.stderr),e.stdout&&t.appendLine(e.stdout),t.appendLine(i(2,null,this.workspaceFolder.name,e.error?e.error.toString():"unknown")),v(),o}var l,d}dispose(){this.promise=void 0,this.fileWatcher&&this.fileWatcher.dispose()}}class b{constructor(){this.detectors=new Map}start(){const e=a.workspace.workspaceFolders;e&&this.updateWorkspaceFolders(e,[]),a.workspace.onDidChangeWorkspaceFolders((e=>this.updateWorkspaceFolders(e.added,e.removed))),a.workspace.onDidChangeConfiguration(this.updateConfiguration,this)}dispose(){this.taskProvider&&(this.taskProvider.dispose(),this.taskProvider=void 0),this.detectors.clear()}updateWorkspaceFolders(e,t){for(const e of t){const t=this.detectors.get(e.uri.toString());t&&(t.dispose(),this.detectors.delete(e.uri.toString()))}for(const t of e){const e=new k(t,m(t.uri.fsPath));this.detectors.set(t.uri.toString(),e),e.isEnabled()&&e.start()}this.updateProvider()}updateConfiguration(){for(const e of this.detectors.values())e.dispose(),this.detectors.delete(e.workspaceFolder.uri.toString());const e=a.workspace.workspaceFolders;if(e)for(const t of e)if(!this.detectors.has(t.uri.toString())){const e=new k(t,m(t.uri.fsPath));this.detectors.set(t.uri.toString(),e),e.isEnabled()&&e.start()}this.updateProvider()}updateProvider(){if(!this.taskProvider&&this.detectors.size>0){const e=this;this.taskProvider=a.tasks.registerTaskProvider("jake",{provideTasks:()=>e.getTasks(),resolveTask:t=>e.getTask(t)})}else this.taskProvider&&0===this.detectors.size&&(this.taskProvider.dispose(),this.taskProvider=void 0)}getTasks(){return this.computeTasks()}computeTasks(){if(0===this.detectors.size)return Promise.resolve([]);if(1===this.detectors.size)return this.detectors.values().next().value.getTasks();{const e=[];for(const t of this.detectors.values())e.push(t.getTasks().then((e=>e),(()=>[])));return Promise.all(e).then((e=>{const t=[];for(const o of e)o&&o.length>0&&t.push(...o);return t}))}}async getTask(e){if(0!==this.detectors.size){if(1===this.detectors.size)return this.detectors.values().next().value.getTask(e);if(e.scope!==a.TaskScope.Workspace&&e.scope!==a.TaskScope.Global&&e.scope){const t=this.detectors.get(e.scope.uri.toString());if(t)return t.getTask(e)}}}}e.activate=function(e){p=new b,p.start()},e.deactivate=function(){p.dispose()}})();var n=exports;for(var s in r)n[s]=r[s];r.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=https://ticino.blob.core.windows.net/sourcemaps/74b1f979648cc44d385a2286793c226e611f59e7/extensions/jake/dist/main.js.map